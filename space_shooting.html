<!DOCTYPE html>
<html lang="en-us">
<head>

<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />

<title>Space X</title>

</head>

<body style="height: 100%; margin:0 0 0 0;">

<!-- START GAME SCREEN-->
<center>
	<div id="startGame">
		<div id="endContent">
				<a>Space X</a>
				<div class="buttons">
					<button class="btn-hover color-8" onclick="startgame()">ARE U READY?</button>
				</div>

		</div>
	</div>
</center>
<!-- END GAME SCREEN -->
<center>
    <div id="endGame">
        <div id="endContent">
            <h1 id="youDied">Game Over</h1>
            <h1 id="nscore">Score :&nbsp;<span id="test">0</span></h1>
		</div>
		<div class="buttons">
				<button class="btn-hover color-3" onclick="endgame()">TRY AGAIN?</button>
		</div>
    </div>
</center>
	<!-- BACKGROUND -->

	<div class='stars'></div>
	<div class='twinkling'></div>
	<div class='clouds'></div>
	<canvas id="canvas" style="position: absolute; background-size:cover; top:0%; left:0%; height: 100%; width:100%; display:none;"></canvas>
	<!-- SOUND -->
	<audio id="bgvolume" autoplay loop>
		<source src="sound/playing.mp3" type="audio/ogg">
	</audio>
	<audio id="startscreen" autoplay loop>
		<source src="sound/startgame.mp3" type="audio/ogg">
	</audio>
	<audio id="endscreen" autoplay loop>
		<source src="sound/endgame.mp3" type="audio/ogg">
	</audio>
	<audio id="attack" preload="auto">
		<source src="sound/attacksound.mp3" type="audio/ogg">
	</audio>
	<audio id="damage" preload="auto">
		<source src="sound/damage.mp3" type="audio/ogg">
	</audio>
	<audio id="diedagain" preload="auto">
		<source src="sound/died.mp3" type="audio/ogg">
	</audio>
	<audio id="shot" preload="auto">
		<source src="sound/shot.mp3" type="audio/ogg">
	</audio>


	<!-- BACKGROUND STYLE -->
<style type="text/css">
	* {
		-webkit-box-sizing: border-box;
		-moz-box-sizing: border-box;
		box-sizing: border-box;
	}

	.buttons {
		margin: 10%;
		position: absolute;
		top:45%;
		left:32%;
		font-family:helvetica, arial, sans-serif;
		text-align: center;
	}

	.btn-hover {
		width: 200px;
		font-size: 16px;
		font-weight: 600;
		color: #fff;
		cursor: pointer;
		margin: 20px;
		height: 55px;
		text-align:center;
		border: none;
		background-size: 300% 100%;
		border-radius: 50px;
		moz-transition: all .4s ease-in-out;
		-o-transition: all .4s ease-in-out;
		-webkit-transition: all .4s ease-in-out;
		transition: all .4s ease-in-out;
	}

	.btn-hover:hover {
		background-position: 100% 0;
		moz-transition: all .4s ease-in-out;
		-o-transition: all .4s ease-in-out;
		-webkit-transition: all .4s ease-in-out;
		transition: all .4s ease-in-out;
	}

	.btn-hover:focus {
		outline: none;
	}
	.btn-hover.color-3 {
		background-image: linear-gradient(to right, #667eea, #764ba2, #6B8DD6, #8E37D7);
		box-shadow: 0 4px 15px 0 rgba(116, 79, 168, 0.75);
	}
	.btn-hover.color-8 {
		background-image: linear-gradient(to right, #29323c, #485563, #2b5876, #4e4376);
		box-shadow: 0 4px 15px 0 rgba(45, 54, 65, 0.75);
	}
	body{
		background: #000 url('images/stars.png') repeat top center;
	}
	.stars, .twinkling, .clouds {
	    position:absolute;
	    display:block;
	    top:0; bottom:0;
	    left:0; right:0;
	    width:100%; height:100%;
	}
	.stars {
	    z-index: -3;
	    background: #000 url('images/stars.png') repeat top center;
	    animation: move-star-back 100s linear infinite;
	}
	.twinkling{
	    z-index: -2;
	    background:transparent url('images/twinkling.png') repeat top center;
	    animation: move-twink-back 200s linear infinite;
	}
	.clouds{
	    z-index: -1;
	    background:transparent url('images/clouds.png') repeat top center;
	    animation: move-clouds-back 150s linear infinite;
	}
	@keyframes move-star-back {
	    from {background-position:0 0;}
	    to {background-position:0 5000px;}
	}
	@keyframes move-twink-back {
	    from {background-position:0 0;}
	    to {background-position:-10000px 5000px;}
	}
	@keyframes move-clouds-back {
	    from {background-position:0 0;}
	    to {background-position:10000px 5000px;}
	}
	#youDied{
    position: relative;
    top:200px;
    margin: 0px;
    color: aliceblue;
    font-size: 50px;
    font-family: 'Kaushan Script', cursive;
	}
	#nscore{
    font-size: 50px;
    position: relative;
    top: 200px;
    color: #fff;
	}
	#endGame{
    position: absolute;
    background-size:cover;
    top:0%;
    left:0%;
    height: 100%;
    width:100%;
    display: none;
    background-image: url("images/uni.png");
	}
	#startGame{
	position:absolute;
	background-size: cover;
	top:0%;
	left:0%;
	height: 100%;
	width: 100%;
	display : block;
	background-image: url("images/uni.png");
	}
	/* START GAME SCREEN*/
	#input{
		position:absolute;
		top:60%;
		left:40.5%;
		padding: 30px 60px;
		font-size: 24px;
		text-align: center;
		cursor: pointer;
		outline: none;
		color: #fff;
		background-color: #4CAF50;
		border: none;
		border-radius: 15px;
		box-shadow: 0 9px #999;
  	}
	#input:hover{
	    background-color: #3e8e41;
	}
	#input:active {
		background-color: #3e8e41;
		box-shadow: 0 5px #666;
		transform: translateY(4px);
	}
		@keyframes tipsy {
	0 {
		transform: translateX(-50%) translateY(-50%) rotate(0deg);
	}
	100% {
		transform: translateX(-50%) translateY(-50%) rotate(360deg);
	}
	}

	body {
	font-family: helvetica, arial, sans-serif;
	}

	a {
	color: #fffbf1;
	text-shadow: 0 20px 25px #2e2e31, 0 40px 60px #2e2e31;
	font-size: 80px;
	font-weight: bold;
	text-decoration: none;
	letter-spacing: -3px;
	margin: 0;
	position: absolute;
	top: 30%;
	left: 50%;
	transform: translateX(-50%) translateY(-50%);
	}

	a:before,
	a:after {
	content: '';
	padding: .9em .4em;
	position: absolute;
	left: 50%;
	width: 100%;
	top: 50%;
	display: block;
	border: 15px solid red;
	transform: translateX(-50%) translateY(-50%) rotate(0deg);
	animation: 10s infinite alternate ease-in-out tipsy;
	}

	a:before {
	border-color: #d9524a #d9524a rgba(0, 0, 0, 0) rgba(0, 0, 0, 0);
	z-index: -1;
	}

	a:after {
	border-color: rgba(0, 0, 0, 0) rgba(0, 0, 0, 0) #d9524a #d9524a;
	box-shadow: 25px 25px 25px rgba(46, 46, 49, .8);
	}
</style>


<script type="text/javascript">
// SOUND
var end_sound = document.getElementById("endscreen");
var start_sound = document.getElementById("startscreen");
var bgvol = document.getElementById("bgvolume");
end_sound.pause();
start_sound.play();
bgvol.pause();
bgvol.volume = 0.05;
start_sound.volume = 0.05;
end_sound.volume = 0.08;
function sound(id){
        document.getElementById(id).play();
    }
// INITIAL SETUP
var canvas = document.getElementById('canvas'),
    c = canvas.getContext('2d');
var innerWidth = 2000,
	innerHeight = 800;
	canvas.width = innerWidth;
	canvas.height = innerHeight;

// VARIABLES
var score = 0,
	lastTime = 0;
// Mouse movement
addEventListener("mousemove", function(event)
{
  	player.x = event.clientX*1.3;
	player.y = event.clientY*1.2;
} );
// PLAYER SETUP
var player = {},
    player_width =  80,
	player_height = 55,
	player_img = new Image();
	player_img.src = 'images/360.png';
// CREATE PLAYER
	player = {
	width : player_width,
	height: player_height,
	x : innerWidth/2 - player_width/2,
	y : innerHeight - (player_height+10),
	power : 100,
	draw: function(){
	   if(this.x <= 0){
	     this.x = 0;
	   }else if(this.x >= (innerWidth - this.width)){
	     this.x = (innerWidth -this.width);
	   }
	   if(this.y <= 0){
	     this.y = 0;
	   }else if(this.y >= (innerHeight - this.height)){
	     this.y = (innerHeight - this.height);
	   }
	   c.drawImage(player_img, this.x, this.y, this.width, this.height);
	}
};
// ROTATE
var click_c = 0;
addEventListener("click", function(){
	if(click_c == 1 || click_c == 3 || click_c == 5 || click_c == 7){
		player.width = 95;
		player.height = 90;
	}
	else if(click_c == 2 || click_c == 6){
		player.width = 90;
		player.height = 80;
	}
	else if(click_c == 0 ||click_c == 4 || click_c == 8){
		player.width = 80;
		player.height = 55;
	}
	if(click_c == 0){
		player_img.src = 'images/360.png';
		click_c++;
	}
	else if(click_c == 1){
		player_img.src = 'images/45.png';
		click_c++;
	}
	else if(click_c == 2){
		player_img.src = 'images/90.png';
		click_c++;
	}
	else if(click_c == 3){
		player_img.src = 'images/135.png';
		click_c++;
	}
	else if(click_c == 4){
		player_img.src = 'images/180.png';
		click_c++;
	}
	else if(click_c == 5){
		player_img.src = 'images/225.png';
		click_c++;
	}
	else if(click_c == 6){
		player_img.src = 'images/270.png';
		click_c++;
	}
	else if(click_c == 7){
		player_img.src = 'images/315.png'
		click_c = 0;
	}
	else if(click_c == 8){
		player_img.src = 'images/360.png'
	}
});

// ENEMY SETUP
var enemyArray = [],
	enemyIndex = 0,
	enemy_width = 55,
	enemy_height = 43,
	enemy_timer = 500,
	random_i = 5,
	enemy_img = new Image();
	enemy_img.src = 'images/enemy2.png';
	boom_img = new Image();
	boom_img.src = 'images/boom.png';
	heal_img = new Image();
	heal_img.src = 'images/heal.png';
// CREATE ENEMY OBJECT
function enemy(x, y, dx, dy, enemy_img, enemy_width, enemy_height, rotation, point,item){
	this.x = x;
	this.y = y;
	this.dx = dx;
	this.dy = dy;
	this.width = enemy_width;
	this.height = enemy_height;
	this.rotation = rotation;
	enemyIndex++;
	enemyArray[enemyIndex] = this;
	this.id = enemyIndex;
	this.point = point;
	this.item = item;

	if (this.item == 1)
	{this.img = heal_img;}
		else {this.img = enemy_img;}
	if (this.point < 2) {
		if(this.rotation < 0.3){
			this.dx = this.dx;
		}else if(this.rotation > 0.6){
			this.dx = -this.dx;
		}else{
			this.dx = 0;
			this.dy = this.dy;
	}
	}
	else {
		if(this.rotation < 0.3){
			this.dy = this.dy;
		}else if(this.rotation > 0.6){
			this.dy = -this.dy;
		}else{
			this.dy = 0;
			this.dx = this.dx;
	}
	}

	this.update = function(){
		this.y += this.dy;
		this.x += this.dx;

		//if(this.x + this.width >= innerWidth){
			//this.dx = -this.dx;
		//}else if(this.x <= 0){
			//this.dx = Math.abs(this.dx);
		//}
		if(this.y > innerHeight + this.height){
			this.delete();
		}
		if(this.x > innerWidth + this.width){
		this.delete();
	}
		this.draw();
	}
	this.delete = function(){
		delete enemyArray[this.id];
	}
	this.draw = function(){
		c.drawImage(this.img, this.x, this.y, this.width, this.height);
	}
}
// CREATE ENEMY FUNCTION
function create_enemy(){
	var random_create_enemy = Math.floor(Math.random() * 4);
	if (random_create_enemy == 0) {
		var x = Math.random() * (innerWidth - enemy_width); //top to below
		var y = -enemy_height;
		var dx = 3;
		var dy = 3;
	}
	else if (random_create_enemy == 1) {
		var x = Math.random() * (innerWidth - enemy_width); //below to top
		var y = innerHeight-enemy_height;
		var dx = 3;
		var dy = -3;
	}
	else if (random_create_enemy == 2) {
		var x =  -enemy_width;
		var y = Math.random() * (innerHeight-enemy_height);//Left to right
		var dx = 3;
		var dy = 1;
	}
	else  {
		var x =  innerWidth - enemy_width;
		var y = Math.random() * (innerHeight - enemy_height);//right to Left
		var dx = -3;
		var dy = 1;
	}
	if (random_i >Math.floor(Math.random() * 100)) {var random_heal_or_enemy =1;} else {var random_heal_or_enemy =0;}

	var rotation = Math.random();
	point = random_create_enemy;

	new enemy(x, y, dx, dy, enemy_img, enemy_width, enemy_height, rotation, point, random_heal_or_enemy);
}
// BULLETS SETUP
var bulletsArray = [],
	bulletIndex = 0,
	bullet_width = 8,
	bullet_height = 20,
	speed = 15,
	bullet_last_time = 0,
	bullet_timer = 150;
// CREATE BULLET OBJECT
function bullet(x, y, width, height, speed){
	this.x = x;
	this.y = y;
	this.width = width;
	this.height = height;
	this.speed = speed;
	bulletIndex++;
	bulletsArray[bulletIndex] = this;
	this.id = bulletIndex;
	this.update = function(){
		this.y += -this.speed;
		if(this.y < -this.height){
			delete this.delete();
		}
		this.draw();
	}
	this.delete = function(){
		delete bulletsArray[this.id];
	}
	this.draw = function(){
		c.beginPath();
		c.rect(this.x, this.y, this.width, this.height);
		c.fillStyle = '#fff';
		c.fill();
		c.stroke();
	}
}
// FIRE BULLETS
function fire(){
	var x = (player.x + player.width/2) - bullet_width/2;
	var y = player.y;
	shot.volume = 0.05;
	shot.currentTime = 0;
	sound("shot");
	new bullet(x, y, bullet_width, bullet_height, speed);
}
// COLLISION FUNCTION
function collides(a, b){
	return a.x < b.x + b.width &&
	a.x + a.width > b.x &&
	a.y < b.y + b.height &&
	a.y+ a.height > b.y;
}
// DETECT COLLISION
function handleCollisions(){
	bulletsArray.forEach(function(bullet){
		enemyArray.forEach(function(enemy){
			if(collides(bullet,enemy)){
				bullet.delete();
				enemy.img = boom_img;
				enemy.dx = 0;
				enemy.dy =0;
				score += 10;
				setTimeout(function() {
  					enemy.delete();
  					attack.currentTime = 0;
					sound("attack");
				}, 100);
				//level
				if (enemy_timer > 150) {
					if (score%120 == 0) {
						enemy_timer  -= 25;
					}
				}

			}
		});
	});
	enemyArray.forEach(function(enemy){
			if(collides(player,enemy)){
				if (enemy.item == 1) {
					if (player.power < 200) {
						player.power += 10; score += 10;
						x.currentTime = 0;
						sound("x");
					}
				}
				else {
					player.power += -20;
					damage.currentTime = 0;
					sound("damage");
				}

				enemy.delete();
			}
		});
}
function died(){
	sound("diedagain");
    canvas.style.display = 'none';
    document.getElementById('endGame').style.display = 'block'; //แสดงหน้า endGame ที่ซ่อนไว้
	document.body.style.cursor = '';
	bgvol.pause();
	end_sound.play();
}
function endgame(){
	window.location.reload();
	document.getElementById('endGame').style.display = 'none';
	document.body.style.cursor = 'none';
}

function startgame(){
	canvas.style.display = 'block';
	document.getElementById('startGame').style.display = 'none';
	document.body.style.cursor = 'none';
	animate();
	click_c = 0;
	bgvol.play();
	start_sound.pause();

}
// ANIMATION LOOP
function animate(currentTime){
    var animation = requestAnimationFrame(animate);
	c.clearRect(0,0, canvas.width, canvas.height);
	// SCORE
	c.font = '30px arial';
	c.fillStyle = '#fff';
	c.fillText('SCORE: '+score, 20, 40);
	// PLAYER POWER
	c.font = '30px arial';
	c.fillStyle = '#fff';
	c.fillText('POWER: '+player.power+"%", innerWidth-210, 40);
	// DRAW PLAYER
	player.draw();
	// CREATE NEW ENEMY EVERY 1 SECONDS
	if(currentTime >= lastTime + enemy_timer){
		lastTime = currentTime;
		create_enemy();
	}
	// UPDATE ENEMY POSITIONS
	enemyArray.forEach(function(enemy){
		enemy.update();
	});
	// FIRE BULLET EVERY 150 MILLISECONDS
	if(currentTime >= bullet_last_time+ bullet_timer){
		bullet_last_time = currentTime;
		fire();
	}
	// UPDATE BULLET POSITIONS
	bulletsArray.forEach(function(bullet){
		bullet.update();
	});
	// DETECT COLLISIONS
	handleCollisions();


	if(player.power <= 0){
		cancelAnimationFrame(animation);
		died();
		document.getElementById("test").innerText = score;
	}
}

</script>
</body>
</html>